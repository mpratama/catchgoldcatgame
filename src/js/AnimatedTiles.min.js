(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory();else if(typeof define==="function"&&define.amd)define([],factory);else if(typeof exports==="object")exports["AnimatedTiles"]=factory();else root["AnimatedTiles"]=factory()})(window,function(){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{configurable:false,enumerable:true,get:getter})}};__webpack_require__.r=function(exports){Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=0)}([function(module,exports,__webpack_require__){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var AnimatedTiles=function(_Phaser$Plugins$Scene){_inherits(AnimatedTiles,_Phaser$Plugins$Scene);function AnimatedTiles(scene,pluginManager){_classCallCheck(this,AnimatedTiles);var _this=_possibleConstructorReturn(this,(AnimatedTiles.__proto__||Object.getPrototypeOf(AnimatedTiles)).call(this,scene,pluginManager));_this.map=null;_this.animatedTiles=[];_this.rate=1;_this.active=false;_this.activeLayer=[];_this.followTimeScale=true;if(!scene.sys.settings.isBooted){scene.sys.events.once("boot",_this.boot,_this)}return _this}_createClass(AnimatedTiles,[{key:"boot",value:function boot(){var eventEmitter=this.systems.events;eventEmitter.on("postupdate",this.postUpdate,this);eventEmitter.on("shutdown",this.shutdown,this);eventEmitter.on("destroy",this.destroy,this)}},{key:"init",value:function init(map){var mapAnimData=this.getAnimatedTiles(map);var animatedTiles={map:map,animatedTiles:mapAnimData,active:true,rate:1,activeLayer:[]};map.layers.forEach(function(){return animatedTiles.activeLayer.push(true)});this.animatedTiles.push(animatedTiles);if(this.animatedTiles.length===1){this.active=true}}},{key:"setRate",value:function setRate(rate){var gid=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var map=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;if(gid===null){if(map===null){this.rate=rate}else{this.animatedTiles[map].rate=rate}}else{var loopThrough=function loopThrough(animatedTiles){animatedTiles.forEach(function(animatedTile){if(animatedTile.index===gid){animatedTile.rate=rate}})};if(map===null){this.animatedTiles.forEach(function(animatedTiles){loopThrough(animatedTiles.animatedTiles)})}else{loopThrough(this.animatedTiles[map].animatedTiles)}}}},{key:"resetRates",value:function resetRates(){var mapIndex=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(mapIndex===null){this.rate=1;this.animatedTiles.forEach(function(mapAnimData){mapAnimData.rate=1;mapAnimData.animatedTiles.forEach(function(tileAnimData){tileAnimData.rate=1})})}else{this.animatedTiles[mapIndex].rate=1;this.animatedTiles[mapIndex].animatedTiles.forEach(function(tileAnimData){tileAnimData.rate=1})}}},{key:"resume",value:function resume(){var _this2=this;var layerIndex=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var mapIndex=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var scope=mapIndex===null?this:this.animatedTiles[mapIndex];if(layerIndex===null){scope.active=true}else{scope.activeLayer[layerIndex]=true;scope.animatedTiles.forEach(function(animatedTile){_this2.updateLayer(animatedTile,animatedTile.tiles[layerIndex])})}}},{key:"pause",value:function pause(){var layerIndex=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var mapIndex=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var scope=mapIndex===null?this:this.animatedTiles[mapIndex];if(layerIndex===null){scope.active=false}else{scope.activeLayer[layerIndex]=false}}},{key:"postUpdate",value:function postUpdate(time,delta){var _this3=this;if(!this.active){return}var globalElapsedTime=delta*this.rate*(this.followTimeScale?this.scene.time.timeScale:1);this.animatedTiles.forEach(function(mapAnimData){if(!mapAnimData.active){return}var elapsedTime=globalElapsedTime*mapAnimData.rate;mapAnimData.animatedTiles.forEach(function(animatedTile){animatedTile.next-=elapsedTime*animatedTile.rate;if(animatedTile.next<0){var currentIndex=animatedTile.currentFrame;var oldTileId=animatedTile.frames[currentIndex].tileid;var newIndex=currentIndex+1;if(newIndex>animatedTile.frames.length-1){newIndex=0}animatedTile.next=animatedTile.frames[newIndex].duration;animatedTile.currentFrame=newIndex;animatedTile.tiles.forEach(function(layer,layerIndex){if(!mapAnimData.activeLayer[layerIndex]){return}_this3.updateLayer(animatedTile,layer,oldTileId)})}})})}},{key:"updateLayer",value:function updateLayer(animatedTile,layer){var oldTileId=arguments.length>2&&arguments[2]!==undefined?arguments[2]:-1;var tilesToRemove=[];var tileId=animatedTile.frames[animatedTile.currentFrame].tileid;layer.forEach(function(tile){if(oldTileId>-1&&(tile===null||tile.index!==oldTileId)){tilesToRemove.push(tile)}else{tile.index=tileId}});tilesToRemove.forEach(function(tile){var pos=layer.indexOf(tile);if(pos>-1){layer.splice(pos,1)}else{console.error("This shouldn't happen. Not at all. Blame Phaser Animated Tiles plugin. You'll be fine though.")}})}},{key:"shutdown",value:function shutdown(){}},{key:"destroy",value:function destroy(){this.shutdown();this.scene=undefined}},{key:"getAnimatedTiles",value:function getAnimatedTiles(map){var _this4=this;var animatedTiles=[];map.tilesets.forEach(function(tileset){var tileData=tileset.tileData;Object.keys(tileData).forEach(function(index){index=parseInt(index);if(tileData[index].hasOwnProperty("animation")){var animatedTileData={index:index+tileset.firstgid,frames:[],currentFrame:0,tiles:[],rate:1};tileData[index].animation.forEach(function(frameData){var frame={duration:frameData.duration,tileid:frameData.tileid+tileset.firstgid};animatedTileData.frames.push(frame)});animatedTileData.next=animatedTileData.frames[0].duration;map.layers.forEach(function(layer){if(layer.tilemapLayer.type==="StaticTilemapLayer"){animatedTileData.tiles.push([]);return}var tiles=[];layer.data.forEach(function(tileRow){tileRow.forEach(function(tile){if(tile.index-tileset.firstgid===index){tiles.push(tile)}})});animatedTileData.tiles.push(tiles)});animatedTiles.push(animatedTileData)}})});map.layers.forEach(function(layer,layerIndex){_this4.activeLayer[layerIndex]=true});return animatedTiles}},{key:"putTileAt",value:function putTileAt(layer,tile,x,y){}},{key:"updateAnimatedTiles",value:function updateAnimatedTiles(){var x=null,y=null,w=null,h=null,container=null;if(container===null){container=[];this.animatedTiles.forEach(function(mapAnimData){container.push(mapAnimData)})}container.forEach(function(mapAnimData){var chkX=x!==null?x:0;var chkY=y!==null?y:0;var chkW=w!==null?mapAnimData.map.width:10;var chkH=h!==null?mapAnimData.map.height:10;mapAnimData.animatedTiles.forEach(function(tileAnimData){tileAnimData.tiles.forEach(function(tiles,layerIndex){var layer=mapAnimData.map.layers[layerIndex];if(layer.type==="StaticTilemapLayer"){return}for(var _x9=chkX;_x9<chkX+chkW;_x9++){for(var _y=chkY;_y<chkY+chkH;_y++){var tile=mapAnimData.map.layers[layerIndex].data[_x9][_y];if(tile.index==tileAnimData.index){if(tiles.indexOf(tile)===-1){tiles.push(tile)}tile.index=tileAnimData.frames[tileAnimData.currentFrame].tileid}}}})})})}}]);return AnimatedTiles}(Phaser.Plugins.ScenePlugin);AnimatedTiles.register=function(PluginManager){PluginManager.register("AnimatedTiles",AnimatedTiles,"animatedTiles")};module.exports=AnimatedTiles}])});